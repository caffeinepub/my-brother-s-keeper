{
  "kind": "build_request",
  "title": "Fix admin access/promotion flow",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Diagnose and fix the end-to-end admin promotion flow so that a user who enters a valid admin token gains admin privileges. This includes: (1) the token is correctly persisted to localStorage before the Internet Identity login redirect, (2) AdminPromotionHandler reliably reads and submits the token after login, (3) the backend promoteToAdmin call succeeds and returns an admin status, and (4) AdminRouteGuard correctly reflects the updated admin status and grants access to protected routes.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "I still am not getting access to the admin"
        ]
      },
      "acceptanceCriteria": [
        "A user can open the AdminAccessDialog, enter a valid admin token, and be promoted to admin after authenticating via Internet Identity",
        "If already logged in, entering a valid token in AdminAccessDialog immediately promotes the user without requiring re-login",
        "After successful promotion, the user can access admin-protected routes (e.g., /admin dashboard) without seeing the AccessDeniedScreen",
        "AdminPromotionHandler correctly reads the stored token post-redirect, calls promoteToAdmin, and clears the token from localStorage regardless of outcome",
        "Backend promoteToAdmin returns a success variant for a valid token",
        "If an invalid token is used, the user sees an appropriate error toast and is not promoted"
      ]
    }
  ],
  "constraints": [
    "Do not change the visual design, graphics, or styling of any page",
    "Do not modify files listed in frontend.immutablePaths"
  ],
  "nonGoals": [
    "Changes to any visual design, layout, or graphics",
    "Adding new admin features or dashboard functionality",
    "Modifying user-facing non-admin authentication flows"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}